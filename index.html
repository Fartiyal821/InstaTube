<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>InstaTube ‚Äî Admin Panel</title>
<meta name="description" content="InstaTube ‚Äî Persistent uploads & interactions">

<link rel="icon" type="image/svg+xml" 
 href="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJyZWQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDI1NiAyNTYiPjxjaXJjbGUgY3g9IjEyOCIgY3k9IjEyOCIgcj0iMTE4IiBmaWxsPSIjZjAwIi8+PHBhdGggZD0iTTEwMCA4MHY5Nmw3Mi00OC05Mi00OCIvPjwvc3ZnPg=="
/>

<style>
:root{ --bg:#0a0a0a; --panel:#111; --muted:#888; --accent:#ff2b2b; }
*{box-sizing:border-box}
body { font-family: Inter, system-ui, -apple-system, Arial, sans-serif; background:var(--bg); color:#eee; margin:0; -webkit-font-smoothing:antialiased }
header { background:var(--panel); border-bottom:1px solid #222; padding:12px 16px; display:flex; align-items:center; gap:12px; position:sticky; top:0; z-index:50 }
header h1 { font-weight:700; font-size:18px; margin:0 }
header h1 span { color:var(--accent) }

.container { display:grid; grid-template-columns:240px 1fr; gap:20px; padding:20px; max-width:1300px; margin:0 auto }
aside { background:var(--panel); padding:12px; border-radius:12px; height:fit-content }
.nav-btn { display:block; width:100%; margin:8px 0; padding:10px; border-radius:10px; background:#161616; color:#fff; border:1px solid #222; cursor:pointer; text-align:left }
.nav-btn:hover{ background:#1f1f1f }

main { min-height:80vh }
section { display:none }
section.active { display:block }
.card { background:var(--panel); border:1px solid #222; border-radius:12px; padding:14px; margin-bottom:16px }
input, textarea { width:100%; padding:10px; margin:8px 0; border-radius:8px; border:1px solid #333; background:transparent; color:#fff }
button.action { padding:10px 14px; margin-top:8px; border:none; border-radius:8px; cursor:pointer; font-weight:700 }
.btn-red{ background:#e53935; color:#fff }
.btn-green{ background:#059669; color:#fff }
.btn-dark{ background:#222; color:#fff }

.comment-box { margin-top:10px }
.comment { background:#141414; padding:8px; border-radius:8px; margin:6px 0; font-size:0.95rem }
.superchat { background:#ffcc00; color:#000; padding:8px; border-radius:8px; margin:6px 0; font-weight:700 }

video, img, audio { max-width:100%; height:auto; border-radius:8px; display:block }

@media (max-width: 1100px){
  .container { grid-template-columns:1fr; padding:12px }
  aside { display:flex; gap:8px; border-radius:10px; padding:8px }
  .nav-btn{ flex:1; margin:0 }
}
@media (max-width:600px){
  header h1{ font-size:16px }
  .card{ padding:10px }
  .nav-btn{ padding:10px 8px }
}

.small { font-size:0.9rem; opacity:0.85 }
</style>
</head>
<body>

<header>
  <h1>Insta<span>Tube</span> ‚Äî Admin</h1>
</header>

<div class="container">
  <aside>
    <button class="nav-btn" data-tab="home">üè† Home</button>
    <button class="nav-btn" data-tab="upload">‚¨ÜÔ∏è Upload</button>
    <button class="nav-btn" data-tab="polls">üìä Polls</button>
    <button class="nav-btn" data-tab="live">üî¥ Live</button>
  </aside>

  <main>
    <section id="home" class="active">
      <h2>Home</h2>
      <div id="videoFeed"></div>
    </section>

    <section id="upload">
      <h2>Upload (Admin only)</h2>
      <form id="uploadForm" class="card" autocomplete="off">
        <label class="small">File</label>
        <input type="file" id="fileInput" accept="video/*,image/*,audio/*">
        <label class="small">Title</label>
        <input type="text" id="titleInput" placeholder="Title">
        <label class="small">Caption</label>
        <textarea id="captionInput" rows="3" placeholder="Caption"></textarea>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="action btn-red" type="submit">Publish</button>
          <button class="action btn-dark" type="button" id="clearLocal">Clear Local Storage</button>
        </div>
        <p class="small" style="margin-top:8px;opacity:0.8">All uploaded posts are persistent and visible to all users.</p>
      </form>
    </section>

    <section id="polls">
      <h2>Create Poll</h2>
      <div class="card">
        <input type="text" id="pollQuestion" placeholder="Poll Question">
        <div id="pollOptions">
          <input type="text" placeholder="Option 1" class="poll-opt">
          <input type="text" placeholder="Option 2" class="poll-opt">
        </div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="action btn-dark" id="addPollOption">+ Add Option</button>
          <button class="action btn-green" id="createPoll">Create Poll</button>
        </div>
      </div>
      <div id="pollList"></div>
    </section>

    <section id="live">
      <h2>Go Live</h2>
      <div class="card">
        <p><b>Stream Key:</b> <span id="streamKey">‚Äî</span></p>
        <button class="action btn-red" id="genKey">Generate Stream Key</button>
        <p class="small" style="margin-top:10px;opacity:0.8">Use this key in OBS Studio (Settings ‚Üí Stream ‚Üí Service: Custom). RTMP URL example: <code>rtmp://yourserver/live</code></p>
      </div>

      <div class="card">
        <h3>Webcam Live Stream</h3>
        <video id="webcamLive" autoplay playsinline muted style="width:100%;border-radius:8px;background:#000"></video>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="action btn-green" id="startWebcam">Start Webcam</button>
          <button class="action btn-red" id="stopWebcam">Stop Webcam</button>
        </div>
      </div>

      <div class="card">
        <h3>Live Chat</h3>
        <div id="liveComments"></div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input type="text" id="liveCommentInput" placeholder="Add a comment...">
          <button class="action btn-dark" id="sendLiveComment">Send</button>
        </div>
      </div>

      <div class="card">
        <h3>Super Chat üí∞</h3>
        <input type="text" id="scName" placeholder="Your Name">
        <input type="text" id="scMsg" placeholder="Message">
        <input type="number" id="scAmount" placeholder="Amount (‚Çπ)">
        <button class="action btn-green" id="sendSuperChat">Send Super Chat</button>
        <div id="superChatFeed" style="margin-top:8px"></div>
      </div>
    </section>
  </main>
</div>

<script>
(function(){
  // Persistent posts, polls, likes/comments
  window.posts = JSON.parse(localStorage.getItem('posts') || '[]');
  window.polls = JSON.parse(localStorage.getItem('polls') || '[]');
  window.userLikes = JSON.parse(localStorage.getItem('userLikes') || '{}');

  function seedDemoData(){
    if(window.posts.length===0){
      const svg = "<svg xmlns='http://www.w3.org/2000/svg' width='800' height='450'><rect width='100%' height='100%' fill='#111'/><text x='50%' y='50%' fill='#fff' font-size='28' text-anchor='middle' dominant-baseline='central'>Welcome to InstaTube Demo</text></svg>";
      const img = 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
      window.posts.push({ title:'Welcome', caption:'Sample image post', url:img, type:'image', comments:[], superchats:[], likes:0 });
      localStorage.setItem('posts', JSON.stringify(window.posts));
    }
    if(window.polls.length===0){
      window.polls.push({ q:'Do you like this demo?', opts:['Yes','No'], votes:[0,0] });
      localStorage.setItem('polls', JSON.stringify(window.polls));
    }
  }

  function escapeHtml(str){ if(!str && str!==0) return ''; return String(str).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]; }); }

  function switchTab(tab){
    document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
    document.getElementById(tab).classList.add('active');
    if(tab==='home') renderPosts();
    if(tab==='polls') renderPolls();
  }

  function renderPosts(){
    const feed = document.getElementById('videoFeed'); feed.innerHTML='';
    window.posts.forEach((p,i)=>{
      const card=document.createElement('div'); card.className='card';
      const title=document.createElement('h3'); title.textContent=p.title;
      const cap=document.createElement('p'); cap.textContent=p.caption;
      const mediaWrapper=document.createElement('div');
      if(p.type==='image'||/data:image|\.png|\.jpg|\.jpeg|\.svg/i.test(p.url)){ const img=document.createElement('img'); img.src=p.url; mediaWrapper.appendChild(img); }
      else if(p.type==='audio'||/\.mp3|\.wav|audio\//i.test(p.url)){ const audio=document.createElement('audio'); audio.controls=true; audio.src=p.url; mediaWrapper.appendChild(audio); }
      else{ const video=document.createElement('video'); video.controls=true; video.src=p.url; mediaWrapper.appendChild(video); }

      // Comments
      const commentBox=document.createElement('div'); commentBox.className='comment-box';
      const commentsDiv=document.createElement('div'); commentsDiv.innerHTML=p.comments.map(c=>`<div class="comment">${escapeHtml(c)}</div>`).join('');
      const commentInput=document.createElement('input'); commentInput.placeholder='Add a comment';
      const commentBtn=document.createElement('button'); commentBtn.textContent='Send'; commentBtn.className='action btn-dark';
      commentBtn.addEventListener('click', ()=>{
        const val=commentInput.value.trim(); if(!val) return; p.comments.push(val);
        localStorage.setItem('posts', JSON.stringify(window.posts)); renderPosts();
      });
      commentBox.appendChild(commentsDiv); commentBox.appendChild(commentInput); commentBox.appendChild(commentBtn);

      // Likes
      const likeBtn=document.createElement('button'); likeBtn.className='action btn-green'; likeBtn.textContent=`Like (${p.likes||0})`;
      likeBtn.addEventListener('click', ()=>{
        if(window.userLikes[i]) return alert('You already liked/unliked'); p.likes=p.likes+1||1;
        window.userLikes[i]=true; localStorage.setItem('userLikes', JSON.stringify(window.userLikes));
        localStorage.setItem('posts', JSON.stringify(window.posts)); renderPosts();
      });

      // SuperChat
      const scBox=document.createElement('div'); scBox.className='comment-box';
      scBox.innerHTML=p.superchats.map(s=>`<div class="superchat">‚Çπ${escapeHtml(s.amount)} - ${escapeHtml(s.name)}: ${escapeHtml(s.msg)}</div>`).join('');

      card.appendChild(title); card.appendChild(mediaWrapper); card.appendChild(cap); card.appendChild(commentBox); card.appendChild(likeBtn); card.appendChild(scBox);
      feed.appendChild(card);
    });
  }

  function uploadPost(){
    const file=document.getElementById('fileInput').files[0]; const title=document.getElementById('titleInput').value.trim();
    const caption=document.getElementById('captionInput').value.trim(); if(!file||!title) return alert('File & title required');

    if(file.type.startsWith('image/')||file.type.startsWith('audio/')){
      const reader=new FileReader();
      reader.onload=e=>{
        const url=e.target.result;
        const type=file.type.startsWith('image/')?'image':'audio';
        window.posts.unshift({ title, caption, url, type, comments:[], superchats:[], likes:0 });
        localStorage.setItem('posts', JSON.stringify(window.posts)); renderPosts(); document.getElementById('uploadForm').reset();
      }; reader.readAsDataURL(file);
    } else{
      const url=URL.createObjectURL(file);
      window.posts.unshift({ title, caption, url, type:'video', comments:[], superchats:[], likes:0 });
      localStorage.setItem('posts', JSON.stringify(window.posts)); renderPosts(); document.getElementById('uploadForm').reset();
    }
  }

  // Polls
  function renderPolls(){ const list=document.getElementById('pollList'); list.innerHTML='';
    window.polls.forEach((p,i)=>{
      const div=document.createElement('div'); div.className='card';
      const q=document.createElement('h4'); q.textContent=p.q;
      div.appendChild(q);
      p.opts.forEach((o,j)=>{
        const btn=document.createElement('button'); btn.className='action btn-dark'; btn.style.display='block'; btn.style.margin='6px 0';
        btn.textContent=`${o} (${p.votes[j]})`;
        btn.addEventListener('click', ()=>{ p.votes[j]++; localStorage.setItem('polls', JSON.stringify(window.polls)); renderPolls(); });
        div.appendChild(btn);
      });
      list.appendChild(div);
    });
  }

  function addPollOption(){ const inp=document.createElement('input'); inp.placeholder='Option'; inp.className='poll-opt';
    document.getElementById('pollOptions').appendChild(inp); }
  document.getElementById('addPollOption').addEventListener('click', e=>{ e.preventDefault(); addPollOption(); });

  document.getElementById('createPoll').addEventListener('click', e=>{
    e.preventDefault();
    const q=document.getElementById('pollQuestion').value.trim();
    const opts=Array.from(document.querySelectorAll('.poll-opt')).map(i=>i.value.trim()).filter(Boolean);
    if(!q||opts.length<2) return alert('Need question & 2+ options');
    window.polls.unshift({ q, opts, votes:Array(opts.length).fill(0) }); localStorage.setItem('polls', JSON.stringify(window.polls));
    document.getElementById('pollQuestion').value=''; document.querySelectorAll('.poll-opt').forEach((n,i)=>{ if(i>1)n.remove(); else n.value=''; });
    renderPolls();
  });

  // Live
  let webcamStream=null;
  document.getElementById('startWebcam').addEventListener('click', async ()=>{
    if(webcamStream) return alert('Webcam already running');
    try{ webcamStream=await navigator.mediaDevices.getUserMedia({ video:true, audio:true });
      document.getElementById('webcamLive').srcObject=webcamStream;
    }catch(err){ alert('Webcam error: '+err); }
  });
  document.getElementById('stopWebcam').addEventListener('click', ()=>{ if(webcamStream){ webcamStream.getTracks().forEach(t=>t.stop()); webcamStream=null; document.getElementById('webcamLive').srcObject=null; } });

  document.getElementById('genKey').addEventListener('click', ()=>{
    const key='LIVE-'+Math.random().toString(36).substring(2,10).toUpperCase(); document.getElementById('streamKey').textContent=key;
  });

  const liveComments=JSON.parse(localStorage.getItem('liveComments')||'[]');
  const superChatFeed=JSON.parse(localStorage.getItem('superChatFeed')||'[]');

  function renderLiveComments(){ document.getElementById('liveComments').innerHTML=liveComments.map(c=>`<div class="comment">${escapeHtml(c)}</div>`).join(''); }
  function renderLiveSuperChats(){ document.getElementById('superChatFeed').innerHTML=superChatFeed.map(s=>`<div class="superchat">‚Çπ${escapeHtml(s.amount)} - ${escapeHtml(s.name)}: ${escapeHtml(s.msg)}</div>`).join(''); }

  document.getElementById('sendLiveComment').addEventListener('click', ()=>{
    const val=document.getElementById('liveCommentInput').value.trim(); if(!val) return;
    liveComments.push(val); localStorage.setItem('liveComments', JSON.stringify(liveComments));
    renderLiveComments(); document.getElementById('liveCommentInput').value='';
  });
  document.getElementById('sendSuperChat').addEventListener('click', ()=>{
    const name=(document.getElementById('scName').value||'').trim();
    const msg=(document.getElementById('scMsg').value||'').trim();
    const amount=(document.getElementById('scAmount').value||'').trim(); if(!name||!msg||!amount) return alert('Fill all fields');
    superChatFeed.push({ name, msg, amount }); localStorage.setItem('superChatFeed', JSON.stringify(superChatFeed));
    renderLiveSuperChats();
    document.getElementById('scName').value=''; document.getElementById('scMsg').value=''; document.getElementById('scAmount').value='';
  });

  document.getElementById('clearLocal').addEventListener('click', ()=>{
    if(confirm('Clear all data?')){ localStorage.clear(); location.reload(); }
  });

  document.querySelectorAll('[data-tab]').forEach(btn=>{ btn.addEventListener('click', ()=>switchTab(btn.dataset.tab)); });

  seedDemoData(); renderPosts(); renderPolls(); renderLiveComments(); renderLiveSuperChats();

  document.getElementById('uploadForm').addEventListener('submit', e=>{ e.preventDefault(); uploadPost(); });

})();
</script>
</body>
</html>
