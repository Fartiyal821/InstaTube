<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>InstaTube ‚Äî Admin & Users</title>
<meta name="description" content="InstaTube ‚Äî Admin can upload, users can watch live and chat.">

<!-- Favicon Icon -->
<link rel="icon" type="image/svg+xml" 
 href="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJyZWQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDI1NiAyNTYiPjxjaXJjbGUgY3g9IjEyOCIgY3k9IjEyOCIgcj0iMTE4IiBmaWxsPSIjZjAwIi8+PHBhdGggZD0iTTEwMCA4MHY5Nmw3Mi00OC05Mi00OCIvPjwvc3ZnPg=="
/>

<style>
:root{ --bg:#0a0a0a; --panel:#111; --muted:#888; --accent:#ff2b2b; }
*{box-sizing:border-box}
body { font-family: Inter, system-ui, -apple-system, Arial, sans-serif; background:var(--bg); color:#eee; margin:0; -webkit-font-smoothing:antialiased }
header { background:var(--panel); border-bottom:1px solid #222; padding:12px 16px; display:flex; align-items:center; gap:12px; position:sticky; top:0; z-index:50 }
header h1 { font-weight:700; font-size:18px; margin:0 }
header h1 span { color:var(--accent) }

.container { display:grid; grid-template-columns:240px 1fr; gap:20px; padding:20px; max-width:1300px; margin:0 auto }
aside { background:var(--panel); padding:12px; border-radius:12px; height:fit-content }
.nav-btn { display:block; width:100%; margin:8px 0; padding:10px; border-radius:10px; background:#161616; color:#fff; border:1px solid #222; cursor:pointer; text-align:left }
.nav-btn:hover{ background:#1f1f1f }

main { min-height:80vh }
section { display:none }
section.active { display:block }
.card { background:var(--panel); border:1px solid #222; border-radius:12px; padding:14px; margin-bottom:16px }
input, textarea { width:100%; padding:10px; margin:8px 0; border-radius:8px; border:1px solid #333; background:transparent; color:#fff }
button.action { padding:10px 14px; margin-top:8px; border:none; border-radius:8px; cursor:pointer; font-weight:700 }
.btn-red{ background:#e53935; color:#fff }
.btn-green{ background:#059669; color:#fff }
.btn-dark{ background:#222; color:#fff }

.comment-box { margin-top:10px }
.comment { background:#141414; padding:8px; border-radius:8px; margin:6px 0; font-size:0.95rem }
.superchat { background:#ffcc00; color:#000; padding:8px; border-radius:8px; margin:6px 0; font-weight:700 }

video, img, audio { max-width:100%; height:auto; border-radius:8px; display:block }

@media (max-width: 1100px){
  .container { grid-template-columns:1fr; padding:12px }
  aside { display:flex; gap:8px; border-radius:10px; padding:8px }
  .nav-btn{ flex:1; margin:0 }
}
@media (max-width:600px){
  header h1{ font-size:16px }
  .card{ padding:10px }
  .nav-btn{ padding:10px 8px }
}

.small { font-size:0.9rem; opacity:0.85 }
</style>
</head>
<body>

<header>
  <h1>Insta<span>Tube</span> ‚Äî Live & Upload</h1>
</header>

<div class="container">
  <aside>
    <button class="nav-btn" data-tab="home">üè† Home</button>
    <button class="nav-btn" data-tab="upload">‚¨ÜÔ∏è Upload</button>
    <button class="nav-btn" data-tab="polls">üìä Polls</button>
    <button class="nav-btn" data-tab="live">üî¥ Live</button>
    <button class="nav-btn" data-tab="profile">üë§ Profile</button>
    <button class="nav-btn" data-tab="story">üìñ Story</button>
  </aside>

  <main>
    <!-- HOME -->
    <section id="home" class="active">
      <h2>Home</h2>
      <div id="videoFeed"></div>
    </section>

    <!-- UPLOAD -->
    <section id="upload">
      <h2>Upload (Admin/User)</h2>
      <form id="uploadForm" class="card" autocomplete="off">
        <label class="small">File</label>
        <input type="file" id="fileInput" accept="video/*,image/*,audio/*">
        <label class="small">Title</label>
        <input type="text" id="titleInput" placeholder="Title">
        <label class="small">Caption</label>
        <textarea id="captionInput" rows="3" placeholder="Caption"></textarea>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="action btn-red" type="submit">Publish</button>
          <button class="action btn-dark" type="button" id="clearLocal">Clear All</button>
        </div>
        <p class="small" style="margin-top:8px;opacity:0.8">Images & audio saved as data-URLs. Videos stored persistently using localStorage + indexedDB.</p>
      </form>
    </section>

    <!-- POLLS -->
    <section id="polls">
      <h2>Create Poll</h2>
      <div class="card">
        <input type="text" id="pollQuestion" placeholder="Poll Question">
        <div id="pollOptions">
          <input type="text" placeholder="Option 1" class="poll-opt">
          <input type="text" placeholder="Option 2" class="poll-opt">
        </div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="action btn-dark" id="addPollOption">+ Add Option</button>
          <button class="action btn-green" id="createPoll">Create Poll</button>
        </div>
      </div>
      <div id="pollList"></div>
    </section>

    <!-- LIVE -->
    <section id="live">
      <h2>Go Live</h2>

      <div class="card">
        <p><b>Stream Key:</b> <span id="streamKey">‚Äî</span></p>
        <button class="action btn-red" id="genKey">Generate Stream Key</button>
        <p class="small" style="margin-top:10px;opacity:0.8">Use this key in OBS Studio (Settings ‚Üí Stream ‚Üí Service: Custom, Server: rtmp://YOUR_SERVER/live).</p>
      </div>

      <div class="card">
        <h3>Live Stream</h3>
        <video id="liveVideo" controls autoplay muted></video>
        <button class="action btn-green" id="startWebcam">Start Webcam Live</button>
      </div>

      <div class="card">
        <h3>Live Chat</h3>
        <div id="liveComments" style="max-height:200px; overflow-y:auto"></div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input type="text" id="liveCommentInput" placeholder="Add a comment...">
          <button class="action btn-dark" id="sendLiveComment">Send</button>
        </div>
      </div>
    </section>

    <!-- PROFILE -->
    <section id="profile">
      <h2>Profile</h2>
      <div class="card">
        <label>Username:</label>
        <input type="text" id="profileName" placeholder="Enter your name">
        <button class="action btn-green" id="saveProfile">Save Profile</button>
      </div>
    </section>

    <!-- STORY -->
    <section id="story">
      <h2>Story</h2>
      <form id="storyForm" class="card">
        <input type="text" id="storyText" placeholder="Add your story...">
        <button class="action btn-green" type="submit">Post Story</button>
      </form>
      <div id="storyFeed"></div>
    </section>

  </main>
</div>

<script>
(function(){
  // --- Storage ---
  window.posts = JSON.parse(localStorage.getItem('posts') || '[]');
  window.polls = JSON.parse(localStorage.getItem('polls') || '[]');
  window.profile = JSON.parse(localStorage.getItem('profile') || '{}');
  window.stories = JSON.parse(localStorage.getItem('stories') || '[]');

  // --- Demo Data ---
  function seedDemoData(){
    if(window.posts.length === 0){
      const svg = "<svg xmlns='http://www.w3.org/2000/svg' width='800' height='450'><rect width='100%' height='100%' fill='#111'/><text x='50%' y='50%' fill='#fff' font-size='28' text-anchor='middle' dominant-baseline='central'>Welcome to InstaTube Demo</text></svg>";
      const img = 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
      window.posts.push({ title:'Welcome', caption:'Sample image post', url: img, type:'image', likes:0, liked:false, comments:[], superchats:[], uploader:'Admin' });
      localStorage.setItem('posts', JSON.stringify(window.posts));
    }
  }

  // --- TAB SWITCH ---
  function switchTab(tab){
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    const el = document.getElementById(tab);
    if(el) el.classList.add('active');
    if(tab === 'home') renderPosts();
    if(tab === 'polls') renderPolls();
    if(tab === 'story') renderStories();
  }
  window.switchTab = switchTab;

  // --- POSTS ---
  function renderPosts(){
    const feed = document.getElementById('videoFeed');
    feed.innerHTML='';
    window.posts.forEach((p,i)=>{
      const card = document.createElement('div'); card.className='card';

      // Media
      let mediaWrapper = document.createElement('div');
      if(p.type==='image') { const img=document.createElement('img'); img.src=p.url; mediaWrapper.appendChild(img); }
      else if(p.type==='audio') { const audio=document.createElement('audio'); audio.controls=true; audio.src=p.url; mediaWrapper.appendChild(audio); }
      else { const video=document.createElement('video'); video.controls=true; video.src=p.url; mediaWrapper.appendChild(video); }

      // Title & caption
      const title=document.createElement('h3'); title.textContent=p.title;
      const cap=document.createElement('p'); cap.textContent=p.caption;

      // Likes
      const likeBtn=document.createElement('button'); likeBtn.textContent=`‚ù§Ô∏è ${p.likes}`; likeBtn.className='action btn-red';
      likeBtn.addEventListener('click', ()=>{
        if(!p.liked){ p.likes++; p.liked=true; } else { p.likes--; p.liked=false; }
        localStorage.setItem('posts', JSON.stringify(window.posts));
        renderPosts();
      });

      // Comments
      const commentBox=document.createElement('div'); commentBox.className='comment-box';
      const commentsDiv=document.createElement('div'); commentsDiv.innerHTML=p.comments.map(c=>`<div class="comment">${escapeHtml(c)}</div>`).join('');
      const cinput=document.createElement('input'); cinput.type='text'; cinput.placeholder='Add comment';
      const cbtn=document.createElement('button'); cbtn.className='action btn-dark'; cbtn.textContent='Send';
      cbtn.addEventListener('click',()=>{ if(cinput.value){ p.comments.push(cinput.value); localStorage.setItem('posts', JSON.stringify(window.posts)); renderPosts(); } });
      commentBox.appendChild(commentsDiv); commentBox.appendChild(cinput); commentBox.appendChild(cbtn);

      // Delete post button
      const delBtn=document.createElement('button'); delBtn.className='action btn-dark'; delBtn.textContent='Delete'; 
      delBtn.addEventListener('click',()=>{ if(confirm('Delete this post?')){ window.posts.splice(i,1); localStorage.setItem('posts',JSON.stringify(window.posts)); renderPosts(); } });

      card.appendChild(title); card.appendChild(mediaWrapper); card.appendChild(cap); card.appendChild(likeBtn); card.appendChild(commentBox); card.appendChild(delBtn);
      feed.appendChild(card);
    });
  }

  function escapeHtml(str){ if(!str && str!==0) return ''; return String(str).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m])); }

  // --- UPLOAD ---
  function uploadPost(){
    const file=document.getElementById('fileInput').files[0];
    const title=document.getElementById('titleInput').value.trim();
    const caption=document.getElementById('captionInput').value.trim();
    if(!file||!title)return alert('Title & file required');

    const reader=new FileReader();
    reader.onload=(e)=>{
      let type='video';
      if(file.type.startsWith('image/')) type='image';
      else if(file.type.startsWith('audio/')) type='audio';
      const url=e.target.result;
      window.posts.unshift({ title, caption, url, type, likes:0, liked:false, comments:[], superchats:[], uploader:window.profile.name||'Anonymous' });
      localStorage.setItem('posts', JSON.stringify(window.posts));
      renderPosts();
      document.getElementById('uploadForm').reset();
    };
    if(file.type.startsWith('video/')) reader.readAsDataURL(file);
    else reader.readAsDataURL(file);
  }

  document.getElementById('uploadForm').addEventListener('submit', e=>{ e.preventDefault(); uploadPost(); });

  // --- POLLS ---
  function addPollOption(){ const inp=document.createElement('input'); inp.placeholder='Option'; inp.className='poll-opt'; document.getElementById('pollOptions').appendChild(inp); }
  document.getElementById('addPollOption').addEventListener('click', e=>{ e.preventDefault(); addPollOption(); });

  function createPoll(){
    const q=document.getElementById('pollQuestion').value.trim();
    const opts=Array.from(document.querySelectorAll('.poll-opt')).map(i=>i.value.trim()).filter(Boolean);
    if(!q||opts.length<2)return alert('Need question & 2+ options');
    window.polls.unshift({q,opts,votes:Array(opts.length).fill(0)});
    localStorage.setItem('polls', JSON.stringify(window.polls));
    renderPolls();
    document.getElementById('pollQuestion').value='';
    document.querySelectorAll('.poll-opt').forEach((n,i)=>{ if(i>1) n.remove(); else n.value=''; });
  }
  document.getElementById('createPoll').addEventListener('click', e=>{ e.preventDefault(); createPoll(); });

  function renderPolls(){
    const list=document.getElementById('pollList'); list.innerHTML='';
    window.polls.forEach((p,i)=>{
      const div=document.createElement('div'); div.className='card';
      const q=document.createElement('h4'); q.textContent=p.q; div.appendChild(q);
      const optsWrap=document.createElement('div');
      p.opts.forEach((o,idx)=>{
        const btn=document.createElement('button'); btn.className='action btn-dark'; btn.style.display='block'; btn.style.margin='6px 0';
        btn.textContent=`${o} (${p.votes[idx]})`; btn.addEventListener('click',()=>{ p.votes[idx]++; localStorage.setItem('polls',JSON.stringify(window.polls)); renderPolls(); });
        optsWrap.appendChild(btn);
      });
      div.appendChild(optsWrap); list.appendChild(div);
    });
  }

  // --- STREAM KEY ---
  function generateStreamKey(){ document.getElementById('streamKey').textContent='LIVE-'+Math.random().toString(36).substring(2,10).toUpperCase(); }
  document.getElementById('genKey').addEventListener('click', generateStreamKey);

  // --- WEBCAM LIVE ---
  const liveVideo=document.getElementById('liveVideo');
  document.getElementById('startWebcam').addEventListener('click', async ()=>{
    try{
      const stream=await navigator.mediaDevices.getUserMedia({video:true,audio:true});
      liveVideo.srcObject=stream;
      liveVideo.play();
    } catch(e){ alert('Webcam error: '+e.message); }
  });

  // --- LIVE CHAT ---
  const liveComments=document.getElementById('liveComments');
  const liveCommentInput=document.getElementById('liveCommentInput');
  document.getElementById('sendLiveComment').addEventListener('click', ()=>{
    const val=liveCommentInput.value.trim();
    if(!val)return;
    const div=document.createElement('div'); div.className='comment'; div.textContent=(window.profile.name||'Anonymous')+': '+val;
    liveComments.appendChild(div);
    liveCommentInput.value='';
  });

  // --- PROFILE ---
  const profileName=document.getElementById('profileName');
  document.getElementById('saveProfile').addEventListener('click', ()=>{
    window.profile.name=profileName.value.trim()||'Anonymous';
    localStorage.setItem('profile', JSON.stringify(window.profile));
    alert('Profile saved!');
  });
  if(window.profile.name) profileName.value=window.profile.name;

  // --- STORIES ---
  document.getElementById('storyForm').addEventListener('submit', e=>{
    e.preventDefault();
    const text=document.getElementById('storyText').value.trim();
    if(!text) return;
    window.stories.unshift({text,by:window.profile.name||'Anonymous',time:new Date().toLocaleTimeString()});
    localStorage.setItem('stories', JSON.stringify(window.stories));
    document.getElementById('storyText').value='';
    renderStories();
  });
  function renderStories(){
    const feed=document.getElementById('storyFeed'); feed.innerHTML='';
    window.stories.forEach((s,i)=>{
      const div=document.createElement('div'); div.className='card';
      div.innerHTML=`<b>${escapeHtml(s.by)}</b> <span class="small">${s.time}</span><p>${escapeHtml(s.text)}</p>`;
      const del=document.createElement('button'); del.className='action btn-dark'; del.textContent='Delete';
      del.addEventListener('click',()=>{ if(confirm('Delete story?')){ window.stories.splice(i,1); localStorage.setItem('stories',JSON.stringify(window.stories)); renderStories(); } });
      div.appendChild(del);
      feed.appendChild(div);
    });
  }

  // --- INIT ---
  seedDemoData();
  renderPosts();
  renderPolls();
  renderStories();
  document.querySelectorAll('.nav-btn').forEach(b=>b.addEventListener('click',()=>switchTab(b.dataset.tab)));

})();
</script>
</body>
</html>
